# Проектная работа 9 спринта

[Ссылка на репозиторий](https://github.com/inikishin/ugc_sprint_2).

## Выполнение задач текущего спринта:
В рамках текущего спринта были выполнены следующие задачи:

1. В файл `docker-compose.yml` добавлены сервисы `elk-logstash`, `elk-elasticsearch`, `elk-kibana`, `elk-filebeat`, предназначенные для сбора логов. После запуска сервисов Kibana доступна по ссылке http://0.0.0.0:5601/
2. Добавлен сервис для сбора информации по лайкам, рецензиям и закладкам. swagger сервиса доступен по ссылке http://ugc-api.local/api/openapi. Данные уходят в kafka, которая должна быть поднята отдельно.
3. Добавлен etl процесс `ugc_etl` получающий данные из kafka и передающий их в clickhouse. 
4. Добавлены дополнительные линтеры в `pre-commit-hook`.

В процессе получения данных по лайкам, рецензиям и закладкам фильмов, kafka была выбрана в качестве транспорта сообщений. Данный продукт является признанным лидером в качестве шины данных, когда требуется передавать очень большие объемы сообщений, но при этом размер их минимальный.

Из kafka данные попадают в БД ClickHouse. Я работал с этой СУБД на двух предыдущих проектах. Основными причинами, почему выбрал ее явялются:
* Быстрый отклик при запросах данных
* Возможность вставки очень большого числа записей
* Наличие sql синтаксиса для работы с данными

## Запуск проекта

Для запуска всех сервисов в корневой директории проекта необходимо ввести команду:

```shell
docker-compose up -d
```

После запуска docker-compose на локальной машине, cервисы доступны по следующим url:
* [http://admin.local](http://admin.local) Admin Service
* [http://api.local](http://api.local) (а также по умолчанию на 80 порту) Movies API
* [http://auth.local](http://auth.local) Auth Service

## Описание сервисов

### Movies API

Основное API на FastAPI, предоставляющее информацию о фильмах.

### Auth Service

Сервис предоставляет возможность работы пользователю с личным кабинетом. Для реализиации аутентификации используется jwt подход.

После запуска docker-compose методы API становятся доступны по базовому url `http://auth.local/`. Описание API в формате OpenAPI 2.0 можно найти по ссылке `http://auth.local/apidocs/`

Сервис использует базу данных PostgreSQL из сервиса `auth_postgres` для хранения данных о пользователях, а также отдельную базу redis в сервисе `redis`, используюмую для хранения просроченных access_tokens.

Для создания суперпользователя можно воспользоваться командой `flask command createsuperuser`.

### Admin Service

Django админ панель для работы с базой данных фильмов PostgreSQL.

### Тесты

Для запуска тестов необходимо из корневой директории перейти в папку `cd tests/functional` и запустить скрипт `./run.sh`